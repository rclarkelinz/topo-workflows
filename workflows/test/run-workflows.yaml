apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  generateName: test-run-workflows-
  namespace: argo
spec:
  entrypoint: main
  arguments:
    parameters:
      - name: workflowtemplate
        value: "test-env"
  templates:
    - name: main
      steps:
        - - name: workflow
            template: triggerWorkflow
            arguments:
              parameters:
              - name: workflowtemplate
                value: "{{workflow.parameters.workflowtemplate}}"

    - name: triggerWorkflow
      inputs:
        parameters:
          - name: workflowtemplate
      resource:
        action: create
        manifest: |
          apiVersion: argoproj.io/v1alpha1
          kind: Workflow
          metadata:
            generateName: {{inputs.parameters.workflowtemplate}}-
          spec:
            workflowTemplateRef:
              name: {{inputs.parameters.workflowtemplate}}
        successCondition: status.phase == Succeeded
        failureCondition: status.phase in (Failed, Error)
